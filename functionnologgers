function pullAllRegions() {

  var props = PropertiesService.getScriptProperties();

  var apiKey = props.getProperty("rapidAPI.key");
  var apiHost = props.getProperty("rapidAPI.host");
  var baseUrl = props.getProperty("baseUrl");

  var pageSize = 500;
  var maxPrice = 950000;
  var minBedrooms = 3;
  var regions = [
    "region:Brisbane - Greater Region, QLD",
    "region:Brisbane - Southern Region, QLD",
    "region:Brisbane - Western Region, QLD"
  ];

  var spreadsheet = SpreadsheetApp.getActive();
  var sheet = spreadsheet.getSheetByName("PropertyAPI");

  if (!sheet) {
    sheet = spreadsheet.insertSheet("PropertyAPI");
  }

  sheet.clear();

  sheet.getRange(1,1,1,23).setValues([[
    "Region",
    "Title",
    "StreetAddress",
    "Suburb",
    "Postcode",
    "DisplayPrice",
    "PriceRange",
    "PropertyType",
    "Bedrooms",
    "Bathrooms",
    "CarSpaces",
    "Features",
    "LandSize",
    "Description",
    "ListingID",
    "AgencyListingID",
    "AgencyName",
    "AgencyEmail",
    "Inspection1",
    "Inspection2",
    "Inspection3",
    "ModifiedDate",
    "Link"
  ]]);

  var allResults = [];

  for (var r = 0; r < regions.length; r++) {

    var params = [
      "locationId=" + encodeURIComponent(regions[r]),
      "pageSize=" + pageSize,
      "maxPrice=" + maxPrice,
      "minBedrooms=" + minBedrooms
    ];

    var url = baseUrl + "?" + params.join("&");

    var options = {
      method: "GET",
      headers: {
        "X-RapidAPI-Key": apiKey,
        "X-RapidAPI-Host": apiHost
      }
    };

    var response = UrlFetchApp.fetch(url, options);
    var status = response.getResponseCode();

    if (status !== 200) {
      continue;
    }

    var json;
    try {
      json = JSON.parse(response.getContentText());
    } catch (e) {
      continue;
    }

    if (!json.data || !Array.isArray(json.data) || json.data.length === 0) {
      continue;
    }

    for (var i = 0; i < json.data.length; i++) {
      var p = json.data[i];

      var propertyType = (p.propertyType || "").toLowerCase();

      if (
        propertyType === "retirement living" ||
        propertyType === "residential land"
      ) {
        continue;
      }

      var streetAddress = p.address?.streetAddress || "";
      var suburb = p.address?.locality || "";
      var postcode = p.address?.postcode || "";

      var displayPrice = p.price?.display || "";
      var priceRange = p.advertising?.priceRange || "";

      var bedrooms = p.features?.general?.bedrooms || "";
      var bathrooms = p.features?.general?.bathrooms || "";
      var carSpaces = p.features?.general?.parkingSpaces || "";

      var landSize = p.landSize?.value || "";
      var description = p.description || "";

      var listingId = p.listingId || "";
      var agencyListingId = p.agencyListingId || "";

      var agencyName = p.agency?.name || "";
      var agencyEmail = p.agency?.email || "";

      var link = p._links?.prettyUrl?.href || "";

      var modifiedDate = p.modifiedDate
        ? new Date(p.modifiedDate)
        : "";

      var featureList = [];

      if (Array.isArray(p.propertyFeatures)) {
        p.propertyFeatures.forEach(function(group) {
          if (Array.isArray(group.features)) {
            featureList = featureList.concat(group.features);
          }
        });
      }

      var features = featureList.join(", ");

      var inspections = (p.inspectionsAndAuctions || [])
        .filter(function(i) {
          return i.auction === false && i.startTime;
        })
        .sort(function(a, b) {
          return new Date(a.startTime) - new Date(b.startTime);
        })
        .slice(0, 3)
        .map(function(i) {
          return new Date(i.startTime);
        });

      while (inspections.length < 3) {
        inspections.push("");
      }

      allResults.push([
        regions[r],
        p.title || "",
        streetAddress,
        suburb,
        postcode,
        displayPrice,
        priceRange,
        p.propertyType || "",
        bedrooms,
        bathrooms,
        carSpaces,
        features,
        landSize,
        description,
        listingId,
        agencyListingId,
        agencyName,
        agencyEmail,
        inspections[0],
        inspections[1],
        inspections[2],
        modifiedDate,
        link
      ]);
    }
  }

  if (allResults.length > 0) {
    sheet.getRange(2,1,allResults.length,23).setValues(allResults);
  }
}
